<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="project.singasong.playlistSong.repository.PlaylistSongRepository">

    <select id="findByPlaylistId" parameterType="project.singasong.playlistSong.dto.PlaylistSongPagingDto" resultType="project.singasong.playlistSong.dto.PlaylistSongPagingDto">
        SELECT
            p.song_id as songId,
            p.playlist_id as playlistId,
            s.title as title,
            s.singer as singer,
            s.song_no as songNo,
            s.brand as brand
        FROM playlist_song p
        JOIN song s on p.song_id = s.id
        WHERE p.playlist_id = #{playlistId} AND song_id > #{offset}
        ORDER BY p.song_id ASC
        LIMIT #{limit}
    </select>

    <select id="findByPlaylistIdAndSongId" parameterType="project.singasong.playlistSong.domain.PlaylistSong" resultType="project.singasong.playlistSong.domain.PlaylistSong">
        SELECT
            song_id,
            playlist_id
        FROM playlist_song
        WHERE playlist_id = #{playlistId}
            AND song_id = #{songId}
    </select>

    <insert id="create" parameterType="project.singasong.playlistSong.domain.PlaylistSong" useGeneratedKeys="true" keyColumn="songId">
        INSERT INTO playlist_song(
            song_id,
            playlist_id
        ) VALUES (
            #{songId},
            #{playlistId}
        )
    </insert>

    <delete id="delete" parameterType="java.lang.Long">
        DELETE FROM playlist_song
        WHERE playlist_id = #{playlistId} AND song_id = #{songId}
    </delete>

</mapper>